////
/// @group utils
/// @author cgoern
////

@use 'sass:color';
@use 'sass:math';
@use 'sass:meta';
@use './config';

/// Convert an absolute RGB channel value to a relative decimal value.
///
/// @since 1.0.0
/// @access public
/// @param {number} $channelValue - Absolute RGB channel value `(0..255)`.
/// @return {number}
@function calcColorChannelRelative($channelValue) {
  @if meta.type-of($channelValue) == 'number' {
    @if $channelValue >= 0 and $channelValue <= 255 {
      @return math.div(math.round(math.div($channelValue, 255) * 1000), 1000);
    } @else {
      @error 'Not in range...';
    }
  } @else {
    @error 'Not a number...';
  }
}

/// Convert an relative decimal RGB channel value to an absolute value.
///
/// @since 1.0.0
/// @access public
/// @param {number} $channelValue - Relative RGB channel value `(0..1)`.
/// @return {number}
@function calcColorChannelAbsolute($channelValue) {
  @if meta.type-of($channelValue) == 'number' {
    @if $channelValue >= 0 and $channelValue <= 1 {
      @return math.round($channelValue * 255);
    } @else {
      @error 'Not in range...';
    }
  } @else {
    @error 'Not a number...';
  }
}

/// Convert a color to a Display P3 color function.
///
/// @since 1.0.0
/// @access public
/// @param {color} $color - A color.
/// @require {function} calcColorChannelRelative
/// @return {string}
@function convertColorDisplayP3($color) {
  @if meta.type-of($color) == 'color' {
    $red: calcColorChannelRelative(color.red($color));
    $green: calcColorChannelRelative(color.green($color));
    $blue: calcColorChannelRelative(color.blue($color));
    $alpha: color.alpha($color) * 100%;

    @return color(display-p3 #{$red} #{$green} #{$blue} / #{$alpha});
  } @else {
    @error 'Not a color...';
  }
}

/// Declare a named color as a CSS custom property.
///
/// @since 1.0.0
/// @access public
/// @param {string} $name - The color name.
/// @param {color} $value - The color value.
/// @param {string} $namespace [config.$namespace] - The namespace for the CSS custom property.
/// @output CSS custom property
@mixin declareColor($name, $value, $namespace: config.$namespace) {
  @if meta.type-of($name) != 'string' {
    @error 'Name #{$name} is not a string.';
  } @else if meta.type-of($value) != 'color' {
    @error 'Value #{$value} is not a color.';
  } @else if meta.type-of($namespace) != 'string' {
    @error 'Namespace #{$namespace} not a string...';
  } @else {
    --#{$namespace}-#{$name}: #{$value};
  }
}
